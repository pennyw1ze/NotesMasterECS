# DPLL procedure for SAT
## Decision Procedures - Automated reasoning

- **model checking** : $I \models \phi$ Does the interpretation satisfy $\phi$.
- **satisfiability**: $\exists^? I:I \models \phi$ Is there a model of $\phi$?
- **logical implication**: $\Gamma \models^? \phi$ is every model of the set of formulas $\Gamma$ a model of $\phi$ as well? Check un-satisfiability of $\Gamma \cup \{\neg \phi\}$
Logical implication directly implies satisfiability!
Satisfiability also implies to have logical inference, which asks for a proof. Satisfiability has been resolved with the Tableaux problem, but today we'll see the main one used in algorithms.
# DPLL
## Conjunctive Normal Form (CNF)
This is the form that DPLL asks as an input.

>It's a conjunction of clauses, which means that the disjunctions of literals (or-connected) are conjunct together (and-connected).


$(p \vee \neg q \vee r) \wedge (q \vee r) \wedge (\neg p \vee \neg q) \wedge r$

A formula in **CNF** has the following shape:
$$\bigwedge_{i=1}^m(\bigvee_{j=1}^{n_j} l_{i,j})$$
The issue now is to see if we can _transform a generic formula into an equivalent CNF one_. Yes! But it requires at worst to check all possible interpretations (and here the $NP-complete$ problem)
### Equi-satisfiability
We'll relax equivalency with equi-satisfiablity:
>Given two formulas $\phi$ and $\phi'$, they are equi-satisfiable iff:
>$\phi$ is satisfiable if and only if $\phi'$ is satisfiable

This can be constructed in poly-time! Better than equivalency transformations. Equi-satisfiability is not equivalency, especially when having more literals in one of them (e.g. $(a \vee b)\wedge c$ is equi-satisfiable to $a \vee \neg a$, but they are not equivalent).
## Tseitin's Transformation
>It converts any propositional formula $\phi$ into an equi-satisfiable formula $\phi'$ in CNF with only a linear increase in time

for any formula, we can create a $3-CNF$ formula.
The Tseitin transformation $T(\psi)$ of $\psi$ is the conjunction of :
- $n_\psi$, with $n_\psi$ being $\psi$ when it is a literal, and being a new propositional letter if not.
- CNF($q \equiv \neg n_\psi$ ) for every non-literal subformula of the form $\neg \psi$ having name $q$
- CNF($q \equiv (n_{\psi_1} \square n_{\psi_2})$)  for every subformula having name q, where $\square \in \{\vee, \wedge, \implies, \equiv\}$ 
### Example
$\psi = (p \vee q) \rightarrow (p \wedge \neg r)$ 
$x_1 = \psi$, $x_2 = (p \vee q)$, $x_3 = (p \wedge \neg r)$
we  define then these three parts:
$CNF(x_1 \equiv x_2 \rightarrow x_3) = \phi_1: (\neg x_1 \vee \neg x_2 \vee x_3) \wedge (x_2 \vee x_1) \wedge (\neg x_3 \vee x_1)$ 
$CNF(x_2 \equiv (p \vee q)) = \phi_2 : (\neg x_2 \vee p \vee q) \wedge (\neg p \vee x_2) \wedge (\neg q \vee x_2)$ 
$CNF(X_3 \equiv (p \wedge \neg r)) =  \phi_3 : (\neg x_3 \vee p) \wedge (\neg x_3 \vee \neg r) \wedge (\neg p \vee r \vee x_3)$

We now can say that $T(\psi) = x_1 \wedge \phi_1 \wedge \phi_2 \wedge \phi_3$ 
## Clauses properties
- If a clause $C$ is obtained by _reordering the literals_ of a clause $C'$, then $C'$ and $C$ are equivalent. (Commutative property)
- If a clause contains _more than one occurrence of the same literal_ then it's equivalent to the clause obtained by deleting all but one such occurrence (Associative property)
- We can represent the clause as a _set of literals_, leaving disjunction implicit.
## CNF properties
- Clause order doesn't matter (Commutative)
-  If a CNF formula contains _more than one occurrence of the same clause_ then it's equivalent to the CNF formula obtained by deleting all but one such occurrence (Associative property)
- A CNF formula can be represented as a set of clauses, which in turn can be seen as a set of literals.
---
Let $\psi = \{C_1, ..., C_n\}$:
- $I \models \psi$ if and only if $I \models C_i$ for all $i = 1,..,n$
- $I \models C_i$ if and only if for some $l \in C, I \models l$
To check that $I$ is an interpretation for $\psi$, we don't necessarily need to know the truth values that I assigns to all literals appearing in $\psi$. Others may not need to be defined to still have $I$ to be an interpretation.

>A partial interpretation is a partial function that associates to some propositional variables of the alphabet $P$ a truth value (either true or false) and can be undefined for the others.

The idea is to apply simplifications to a given formula.
For any CNF formula $\phi$ and a literal $\gamma$, then $\phi|_\gamma$ stands for the formula obtained from $\phi$ by:
- removeing all clauses containing the literal $\gamma$
- removing the literals $\neg \gamma$ in all remaining clauses.
## Unit Propagation
>A **Unit clause** is a clause containing a single literal

If the CNF formula contains a unit clause, then that literal must be evaluated to true. We have a forced choice to do. Once we have evaluated the unit clause to true, ==we can remove the literal in the unit clause from every clause in the CNF formula where the literal is not satisfied, and we can remove every other clause that contains the literal==.
```
UnitPropagation({{p}, {!p, !q}, {!q, r}}, emptyset)
I(p) = true
	-> {{!q}, {!q, r}}
I(q) =  false
	-> {}
```
The procedure for the run above returns $(\{\}, I = \{p\})$.

In the case in which `UnitPropagation` does not have unit clauses we may need to use splitting rules and evaluate both formulas, creating for it a derivation tree.
### Algorithm
Unit Propagation is a sub-procedure which takes the formula as an input and the interpretation of the current sub-formula.
- Given the formula it checks for a unit clause, and if there is it'll extend the Interpretation to satisfy that. From the formula we'll then remove all occurrences of the negated literal of the unit clause, and we'll remove all clauses that contain the literal.
In the case in which we are left with a set of empty clause then our  interpretation satisfies our partial solution; otherwise we need to apply the splitting rule to the clause, by selecting one literal and adding a unit clause of that literal, and running DPLL on that.

DPLL has a time complexity $O(2^m)$, but in most cases it's much faster to build the truth table. 